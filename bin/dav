#!/usr/bin/env ruby
require 'rubygems'
require 'davclient'

def print_usage
  puts "usage: #{$0} COMMAND [ARGS]"
  puts ""
  puts "Available #{$0} commands:"
  puts "   ls        List files on webdav server"
  puts "   pwd       Print current working url"
  puts "   cd        Change current working url"
  puts "   propfind  Print webdav properties for url"
  puts ""
  puts "See '#{$0} COMMAND -h' for more information on a specific command."
  exit
end

def exec_dav(args)
  command =  args[0]
  if(command == "-h" or command =~ /help/ or command =~ /\?/) then
    print_usage
  end

  if(command == "-v" or command =~ /version/ ) then
    puts "#{$0} version " + WebDAV.version
    exit
  end

  case command
    when "ls" then
      require 'davclient/dav-ls'
      WDav.ls(args[1..200])
    when "pwd"
      require 'davclient/dav-pwd'
    when "cd"
      url = args[1]
      begin
        WebDAV.cd(url)
        puts "Changing WebDAV URL to: " + WebDAV.CWURL
      rescue Exception => exception
        puts exception
      end

    when "propfind"
      require 'davclient/dav-propfind'
    when "props"
      require 'davclient/dav-propfind'
    else
      puts "Unknown command :'" + command + "'"
      print_usage
  end
end

if $0 == __FILE__
  exec_dav(ARGV)
end
